<ion-content padding #forumContent>
  <!-- Refresher -->
  <ion-refresher (ionRefresh)="doRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading Spinner -->
  <ion-grid class="align-things-center" *ngIf="pageLoadFlag">
    <ion-row col-12 class="align-things-center">
      <ion-col col-12>
        <div class="main-spinner"></div>
      </ion-col>
    </ion-row>
  </ion-grid>

  <ion-grid *ngIf="!pageLoadFlag">
    <!-- Back button -->
    <ion-row class="top-row">
      <ion-col col-3 class="back-arrow above-map" (tap)="homePage()">
        <img src="assets/icon/custom/back_arrow.png">
      </ion-col>
    </ion-row>
    <ion-row style="margin-top: 20px;">
      <ion-card class="forum-card">
        <ion-row>
          <ion-col col-12>
            <div class="single-row forum-tag"># {{ forum?.tag?.name }}</div>
            <div class="single-row forum-time">
              <ion-note>
                Posted {{ publishedTime }}
              </ion-note>
            </div>
          </ion-col>
        </ion-row>
        <ion-row>
          <ion-col col-8>
            <ion-row>
              <ion-col col-3 (click)="openUser()">
                <div class="avatar" *ngIf="forum?.addedBy?.photo; else showDummyImage" [ngStyle]="{'background-image':'url('+ forum?.addedBy?.photo?.thumb200Url +')'}"></div>
                <ng-template #showDummyImage>
                  <div class="avatar" [ngStyle]="{'background-image':'url(assets/imgs/defaultUser.png)'}"></div>
                </ng-template>
              </ion-col>
              <ion-col col-9 class="user-details" (click)="openUser()">
                <h2>{{ forum?.addedBy?.name }}</h2>
              </ion-col>
            </ion-row>
          </ion-col>
        </ion-row>
        <ion-row style="margin-top: 10px;" *ngIf="imageOption && !imageParam">
          <ion-col col-12 (click)="openImage()">
            <div class="main-slider-image" [ngStyle]="{'background-image':'url('+ imageUrl +')'}"></div>
          </ion-col>
        </ion-row>
        <ion-row class="forum-name" style="margin-top: 20px;">
          <ion-col col-12>
            <h2>{{ forum?.title }}</h2>
          </ion-col>
          <ion-col col-12>
            <p class="description">{{ forum?.description }}</p>
          </ion-col>
        </ion-row>
        <ion-row style="margin-top: 20px;">
          <div class="single-row buttons">
            <button ion-button icon-start clear small (click)="like()">
              <ion-icon [class.likeActive]="isLiked?.flag" class="thumbs-up"></ion-icon>
              <div id="count" class="dynamik-font">{{ forum?.likes }}</div>
            </button>
          </div>
          <div class="single-row">
            <button ion-button icon-start clear small (click)="dislike()">
              <ion-icon [class.dislikeActive]="isDisliked?.flag" class="thumbs-down"></ion-icon>
              <div id="count-dislike" class="dynamik-font">{{ forum?.dislikes }}</div>
            </button>
          </div>
          <div class="single-row">
            <button ion-button icon-start clear small>
              <ion-icon class="text"></ion-icon>
              <div class="dynamik-font">{{ forum?.comments }}</div>
            </button>
          </div>
        </ion-row>
      </ion-card>
    </ion-row>

    <!-- Comments section -->
    <ion-row style="margin-top: 20px;">
      <ion-item style="width: 100%;">
        <ion-textarea rows="8" [(ngModel)]="comment" class="text-area" placeholder="What do you think?">
        </ion-textarea>
      </ion-item>
    </ion-row>
    <ion-row class="align-things-center">
      <ion-col col-12>
        <button ion-button class="login-button" round (click)=submitComment()>Add a Comment</button>
      </ion-col>
    </ion-row>

    <ion-row *ngIf="forum?.comments > 0">
      <div col-12 style="width: 100%;">
        <div *ngFor="let comment of forum?.commentsCollection" style="border-bottom: 1px solid #e0e0e0; width: 100%;">
          <forum-comment style="margin-top: 10px;" [forumId]="forum?._id" [data]="comment"></forum-comment>
        </div>
      </div>
    </ion-row>
  </ion-grid>
</ion-content>
